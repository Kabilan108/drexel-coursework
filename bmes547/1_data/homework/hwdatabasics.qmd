---
title: "Data Basics Assignment"
author: "Tony Kabilan Okeke"
date: "January 10, 2023"
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
# Set the working directory to the location of the data file
setwd("/home/muaddib/sietch/courses/bmes547/1_data/homework")
```

```{r packages message=FALSE, warning=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse)
```

In this assignment you are going to analyze this [Immunotherapy dataset](http://archive.ics.uci.edu/ml/datasets/Immunotherapy+Dataset). The study that has produced the dataset is described [here](https://www.ncbi.nlm.nih.gov/pubmed/28086200). The dataset contains only the immunotherapy subset of patients. Review the paper for description of the attributes.

- Create a `hwdatabasics.mlx`, `hwdatabasics.ipynb` or `hwdatabasics.rmd` file to perform the following tasks.

```{r data}
# Download and read the data
url <- "https://archive.ics.uci.edu/ml/machine-learning-databases/00428/Immunotherapy.xlsx"
download.file(url, "Immunotherapy.xlsx")
data <- readxl::read_excel("Immunotherapy.xlsx")
```

- For each attribute, find its correlation with the result of treatment. Exclude result of treatment as an attribute so you do not find its correlation with itself. Note that correlation is not the best measurement for categroical features, especially if there are more than 2 categories. But, for this assignment, we'll ignore this caveat and calculate correlation anyway. You do not need to convert categorical features for this assignment, just use the numbers as they are.

```{r correlation}
# Calculate correlation with the result of treatment
corr <- cor(data, use = "complete.obs")[, 7]

# Store the correlation values in a data frame
results <- tibble(name=names(corr), corr)
```

- For each attribute, find if there is a statistically significant difference in that attribute, between successful and failed treatments. Use *two-sample t-test* for the comparison and find the p-value. Report the names of attributes that you found to be statistically significantly different. You need to decide your own p-value threshold.

```{r t-test}
# Test for statistically significant difference between groups
# Assume that the data is normally distributed, and variance is equal
pvals <- data %>%
    pivot_longer(-Result_of_Treatment) %>%
    group_by(name) %>%
    rstatix::t_test(value ~ Result_of_Treatment, paired = FALSE, var.equal = TRUE) %>%
    select(name, p.value)

# Join to the results data frame
results <- results %>%
    left_join(pvals, by = "name")
```